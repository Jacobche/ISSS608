---
title: "Take-home Exercise 6"
description: |
  In this Take-home Exercise, I will explore to reveal the patterns of community interactions of the city of Engagement (Ohio US) by using social network analysis approach.
  
author:
  - name: Che Xuan 
    url: https://www.linkedin.com/in/jacob-che-xuan-b646a9123/
date: "`r Sys.Date()`"
output: distill::distill_article
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE,
                      eval = TRUE,
                      warning = FALSE,
                      message = FALSE,
                      fig.retina = 3)
```


# Task

**Challenge 1: Demographics and Relationships** involves understanding the city’s demographics. Given social networks and other information about the city, you will analyze the available data to prepare a one-page fact sheet about the city’s demographics, its neighborhoods, and its business base.

In Challenge 1, you will use visual analytic techniques to address the following questions:

- Consider the social activities in the community. What patterns do you see in the social networks in the town? Describe up to ten significant patterns you observe, with evidence and rationale. Limit your response to 10 images and 500 words.

# Overview

In this take-home exercise, social network approach is used to reveal the patterns of community interactions of the [city of Engagement, Ohio USA](https://vast-challenge.github.io/2022/) while addressing the questions stated in the Task section.

The data are processed by using appropriate **tidyverse** family of packages.

# Sketch of Proposed Design

The picture below shows a sketch of the initial design proposed. 

![](img/image1.jpg)


# Installing & Launching R Packages

Before we get started, it is important for us to ensure that the required R packages have been installed. If yes, we will load the R packages. If they have yet to be installed, we will install the R packages and load them onto R environment.

The chunk code below will do the trick.

```{r}
packages = c('igraph', 'tidygraph', 
             'ggraph', 'visNetwork', 
             'lubridate', 'clock',
             'tidyverse', 'ggmap')

for(p in packages){
  if(!require(p, character.only = T)){
    install.packages(p)
  }
  library(p, character.only = T)
}

```

# Importing Data

The code chunk below imports *SocialNetwork.csv* and *Participants.csv* from the rawdata folder into R by using [`read_csv()`](https://readr.tidyverse.org/reference/read_delim.html) of [**readr**](https://readr.tidyverse.org/) package and save them as tibble data frames called *social* and *participants*.

```{r eval=FALSE}
social <- read_csv("rawdata/SocialNetwork.csv")
participants <- read_csv("rawdata/Participants.csv")

glimpse(social)
```

# Data Wrangling

We will add 1 to each Participant Id in *social* and *participants* as vertex id is not allowed to be zero.

```{r eval=FALSE}
participants$participantId = participants$participantId + 1

social$participantIdFrom = social$participantIdFrom + 1
social$participantIdTo = social$participantIdTo + 1
```

We will re-order the fields in *social* data frame such that participantIdFrom & participantIdTo will become the first two columns. Weekday and year_month columns are also added to this data frame.

```{r eval=FALSE}
social <- social %>%
  select(participantIdFrom, participantIdTo, timestamp) %>%
  mutate(weekday = wday(timestamp,
                        label = TRUE,
                        abbr = FALSE))
```

For the ease of visualization, we will aggregate by participantIdFrom, participantIdTo and Weekday using the code chunk below. Weight is set as greater than 55 to ensure a simpler network graph

```{r eval=FALSE}
social_aggregated <- social %>%
  group_by(participantIdFrom, participantIdTo, weekday) %>%
    summarise(weight = n()) %>%
  filter(participantIdFrom != participantIdTo) %>%
  filter(weight > 55) %>%
  ungroup()
```

Data frames *social_aggregated* and *participants* are saved in RDS format to avoid uploading large files to Git.

```{r eval=FALSE}
saveRDS(social_aggregated, 'data/social_aggregated.rds')
saveRDS(participants, 'data/participants.rds')
```

```{r}
social_aggregated <- readRDS('data/social_aggregated.rds')
participants <- readRDS('data/participants.rds')
```

The code chunk below helps to ensure the *participants_selected* contains all distinct Participant Ids from the *social_aggregated* data frame.

```{r}
participants_selected <- participants %>%
  filter(participantId %in% social_aggregated$participantIdFrom) %>%
  filter(participantId %in% social_aggregated$participantIdTo)
```


# Building Tidygraph Data Model

In the code chunk below, `tbl_graph()` of **tinygraph** package is used to build a tidygraph's network graph data.frame.

```{r}
social_graph <- graph_from_data_frame(social_aggregated,
                           vertices = participants_selected) %>%
  as_tbl_graph()

social_graph
```

# Basic Network Graph

The code chunk below uses `ggraph()`, `geom-edge_link()` and `geom_node_point()` to plot a network graph by using *social_graph*.

```{r}
ggraph(social_graph) +
  geom_edge_link() +
  geom_node_point()
```

We can see that this give rises to a series of network plots where we can find relatively simple network such as two persons and relatively complex network such as the one on the upper right corner. Our next task is to extract out the least, moderate and most complex networks and to investigate them in greater detail.













